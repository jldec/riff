## projectriff.io website

This directory contains configuration and markdown content for [projectriff.io](projectriff.io).

This site does not use the built-in docusuarus versioning. HTML is generated by running a [docusarus](https://docusaurus.io/docs/en/installation) build per version on different branches. Each build produces a docs directory, e.g a `v0.3.x` branch build will generate
`docs/0-3`

Finished website HTML for all versions is committed to the [projectriff.io](https://github.com/projectriff/projectriff.io) repo, and published online with GitHub Pages.

### Getting started
To bring in dependencies for the first time:

```sh
npm install
```

To preview using a local dev server:
```sh
npm start
```

The local dev server will only generate the website and a single docs version for this branch. Links to other
docs versions will be broken, but the full site can be previewed by running a static webserver [*](https://github.com/zeit/serve) on the contents of [projectriff.io](https://github.com/projectriff/projectriff.io).

### Creating docs pages

Documentation markdown files live in the `/docs` directory at the same level as this `/website` directory. Typically, new docs pages for the next release are created on the master branch. Each markdown file should include at least the following frontmatter:

```markdown
---
id: documentation-url-slug
title: Documentation Page Title
---

Content...
```
To allow access through the sidebar, docs pages need to be referenced (by their id) in `sidebar.json`.

### Creating blog posts

Blog posts live in the `/website/blog` directory. New Blog posts created in the middle of a release cycle should be created and published (together with the rest of the website) from the latest stable branch.

At the end of a release cycle, blog posts should be committed to the master branch so that they are included when the master branch is tagged to become the next stable release.

Blog post files should follow a naming convention of `YYYY-MM-DD-my-blog-post-title.md`. The lowercase, slugified name following the date will be used for the page url.

Add a `title` to the markdown frontmatter.

```markdown
---
title: New Blog Post
---

Lorem Ipsum...
```

### Building
The commands below assume that the `projectriff.io` repo is cloned at the same level as this repo. To build the full website including homepage, blog, and default docs

```sh
git checkout <vx.x.x for stable>
cd website
npm run build
cp -R build/riff/* ../../projectriff.io/
```

The full site should be published from the latest stable branch. For earlier releases or master branch docs, run the same build steps above, and then copy only the docs/x-x directory. (Be careful to omit the trailing / or else this will copy the files without the directory itself.)

```sh
  cp -R build/riff/docs/x-x ../../projectriff.io/docs/
```

### Release process
To make a release (from the master branch)

- Edit the `versions` array in `siteConfig.js`, marking next as 'stable', and adding a new entry for 'next'.
- Run a build to generate the website, and publish full content to projectriff.io. This will bump the default docs version for the website to the new release from the master branch.
- Validate that everything looks right.
- Commit and tag the release.
- Bump `docsUrl`, and first `headerlinks` label to match the _next_ release version.
- Bump the version for the `/static/docs/x-x` directory to the next release version.
- Bump the version inside all redirect links in `/static/docs/index.html` and `/static/docs/x-x/index.html`.

### Directory Structure
This website uses [Docusaurus](https://docusaurus.io/). See the package.json for specific version.

```
├── docs
│   ├── markdown docs ...
└── website
    ├── blog
    │   ├── ...markdown blog posts...
    ├── core
    │   └── Footer.js (react)
    ├── package.json
    ├── pages
    │   └── en
    │       ├── index.js (react)
    │       └── versions.js (react)
    ├── sidebars.json
    ├── siteConfig.js
    ├── static
    │   ├── css
    │   │   └── custom.css
    │   └── img
    └──     ├── ... images ...
```
